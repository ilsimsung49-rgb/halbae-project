import streamlit as st
import base64
import os

# 1. í˜ì´ì§€ ì„¤ì • (ì›¹í˜ì´ì§€ ì œëª©)
st.set_page_config(layout="wide", page_title="í• ë°°ì˜ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°")

# 2. ë””ìì¸ ì ìš© (ë‹¤í¬ëª¨ë“œ + ìŠ¤íƒ€ì¼)
st.markdown("""
<style>
    /* ì „ì²´ ë°°ê²½ì„ ì–´ë‘ìš´ ìƒ‰ìœ¼ë¡œ */
    .stApp { background-color: #0E1117; color: #FAFAFA; }
    /* ìƒë‹¨ ì—¬ë°± ì¤„ì´ê¸° */
    .block-container { padding-top: 1rem !important; }
    /* ì§€ì €ë¶„í•œ ë©”ë‰´ ìˆ¨ê¸°ê¸° */
    header {visibility: hidden;}
    /* ì œëª© ë°•ìŠ¤ ë””ìì¸ */
    .custom-header {
        background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
        padding: 20px;
        border-radius: 15px;
        color: white;
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px; /* ì‚¬ì§„ê³¼ ê¸€ì ì‚¬ì´ ê°„ê²© */
    }
    .custom-header h1 {
        margin: 0; font-size: 2.2rem; font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
    .profile-img {
        width: 80px; height: 80px;
        border-radius: 50%; /* ë™ê·¸ë—ê²Œ */
        border: 3px solid white; /* í°ìƒ‰ í…Œë‘ë¦¬ */
        object-fit: cover; /* ì‚¬ì§„ ê½‰ ì±„ìš°ê¸° */
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
</style>
""", unsafe_allow_html=True)

# 3. [í•µì‹¬] í• ë°° ì‚¬ì§„ì„ ë˜‘ë˜‘í•˜ê²Œ ì°¾ì•„ì˜¤ëŠ” í•¨ìˆ˜
def get_smart_image_tag():
    # ì½”ë“œê°€ ì°¾ì•„ë³¼ íŒŒì¼ ì´ë¦„ í›„ë³´ë“¤
    possible_names = [
        "image_1.png", "image_1.jpg", "image_1.jpeg",
        "image_1.png.jpg", "image_1.png.png",
        "IMG_7758.jpg", "IMG_7758.png"
    ]
    
    # ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ì´ë¦„ì„ í•˜ë‚˜ì”© ëŒ€ì…í•´ì„œ ì‹¤ì œë¡œ ìˆëŠ”ì§€ í™•ì¸
    for name in possible_names:
        if os.path.exists(name):
            # ì°¾ì•˜ë‹¤! ì´ë¯¸ì§€ë¥¼ ì½ì–´ì„œ ì½”ë“œë¡œ ë³€í™˜
            with open(name, "rb") as f:
                data = base64.b64encode(f.read()).decode()
            # HTML ì´ë¯¸ì§€ íƒœê·¸ë¡œ ë§Œë“¤ì–´ì„œ ë°˜í™˜
            return f'<img src="data:image/png;base64,{data}" class="profile-img">'
    
    # ëê¹Œì§€ ëª» ì°¾ìœ¼ë©´ ê·¸ëƒ¥ í• ë°° ì´ëª¨ì§€ ë°˜í™˜
    return "ğŸ‘´"

# í•¨ìˆ˜ ì‹¤í–‰í•´ì„œ ì´ë¯¸ì§€ íƒœê·¸ ê°€ì ¸ì˜¤ê¸°
icon_html = get_smart_image_tag()

# 4. ì œëª© ì¶œë ¥ (ì‚¬ì§„ + í…ìŠ¤íŠ¸)
st.markdown(f"""
    <div class="custom-header">
        {icon_html}
        <h1>í• ë°°ì˜ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°</h1>
    </div>
""", unsafe_allow_html=True)

# 5. í™”ë©´ êµ¬ì„± (ì™¼ìª½: ì„ íƒ / ì˜¤ë¥¸ìª½: ê²°ê³¼)
col1, col2 = st.columns([1, 1.3])

with col1: # ì™¼ìª½ ë‹¨
    st.subheader("ğŸ› ï¸ Step 1. ì¸ë¬¼ & ì˜ìƒ ì„¤ì •")
    c1, c2 = st.columns(2)
    with c1:
        # (í•œê¸€ í‘œì‹œ, ì˜ì–´ ê°’)
        nationality = st.selectbox("ì¸ì¢…/êµ­ì ", [("í•œêµ­ì¸", "Korean"), ("ë¯¸êµ­ì¸", "American"), ("ì¼ë³¸ì¸", "Japanese"), ("ì„œì–‘ì¸", "Western")], format_func=lambda x: x[0])
        age = st.selectbox("ë‚˜ì´ëŒ€", [("10ëŒ€", "teenage"), ("20ëŒ€", "20s"), ("30ëŒ€", "30s"), ("40ëŒ€", "40s"), ("50ëŒ€", "50s"), ("60ëŒ€ ì´ìƒ(ë…¸ì¸)", "elderly senior")], format_func=lambda x: x[0])
    with c2:
        gender = st.selectbox("ì„±ë³„", [("ì—¬ì„±", "woman"), ("ë‚¨ì„±", "man")], format_func=lambda x: x[0])
        style = st.selectbox("ì˜ìƒ", ["ìš°ì£¼ë³µ", "ìºì£¼ì–¼", "ì •ì¥(ìˆ˜íŠ¸)", "í•œë³µ", "íŒíƒ€ì§€ ê°‘ì˜·", "ì‚¬ì´ë²„í‘í¬"])

    st.subheader("ğŸï¸ Step 2. ë°°ê²½ & ìƒí™©")
    situation = st.text_area("ì–´ë–¤ ìƒí™©ì¸ê°€ìš”? (í•œê¸€ë¡œ í¸í•˜ê²Œ)", placeholder="ì˜ˆ: ìš°ì£¼ì—ì„œ ê°•ì•„ì§€ë‘ ì‚°ì±…í•˜ëŠ” ëª¨ìŠµ", height=70)

    st.subheader("ğŸ¨ Step 3. í™”í’ & ë¹„ìœ¨")
    s1, s2, s3 = st.columns(3)
    with s1:
        ratio = st.selectbox("ë¹„ìœ¨", [("16:9 (ìœ íŠœë¸Œ)", "--ar 16:9"), ("9:16 (ì‡¼ì¸ )", "--ar 9:16"), ("1:1 (ì •ë°©í˜•)", "--ar 1:1"), ("4:3 (ì‚¬ì§„)", "--ar 4:3")], format_func=lambda x: x[0])
    with s2:
        camera = st.selectbox("ì¹´ë©”ë¼ ê°ë„", [("ê¸°ë³¸", "default angle"), ("í´ë¡œì¦ˆì—…", "close-up shot"), ("ì „ì‹ ", "full body shot"), ("ê´‘ê°(ë„“ê²Œ)", "wide angle shot"), ("ë“œë¡ ë·°(í•˜ëŠ˜ì—ì„œ)", "drone view shot")], format_func=lambda x: x[0])
    with s3:
        art_style = st.selectbox("í™”í’", [("ì‹¤ì‚¬(ì‚¬ì§„ ê°™ì€)", "Photo-realistic"), ("ì• ë‹ˆë©”ì´ì…˜", "Anime style"), ("ìœ í™”", "Oil painting style"), ("ìˆ˜ì±„í™”", "Watercolor style"), ("ì‚¬ì´ë²„í‘í¬", "Cyberpunk style")], format_func=lambda x: x[0])

    st.markdown("###") # ê°„ê²© ë„ìš°ê¸°
    # ë²„íŠ¼ (í´ë¦­í•˜ë©´ Trueê°€ ë¨)
    generate_btn = st.button("âœ¨ í”„ë¡¬í”„íŠ¸ ìƒì„±í•˜ê¸° (Click)", type="primary", use_container_width=True)

with col2: # ì˜¤ë¥¸ìª½ ë‹¨
    st.subheader("ğŸ“„ ìƒì„±ëœ ê²°ê³¼ (ë³µì‚¬ ê°€ëŠ¥)")
    
    if generate_btn:
        # ì„ íƒí•œ ê°’ë“¤(ì˜ì–´)ë¡œ í”„ë¡¬í”„íŠ¸ ë¬¸ì¥ ë§Œë“¤ê¸°
        # 1. ìƒí™© ë²ˆì—­ (íŒŒíŒŒê³  APIê°€ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ í•œê¸€ ê·¸ëŒ€ë¡œ ì‚¬ìš© - ë‚˜ì¤‘ì— êµ¬ê¸€ ë²ˆì—­ê¸°ì— ëŒë ¤ì“°ì„¸ìš”!)
        translated_situation = situation # ì„ì‹œ

        # 2. ìµœì¢… ë¬¸ì¥ ì¡°ë¦½
        final_prompt = f"A {art_style[1]} image of a {age[1]} {nationality[1]} {gender[1]}, wearing {style}, {translated_situation}, shot with {camera[1]}, high quality, 8k, {ratio[1]}"
        
        # 3. ê²°ê³¼ ë³´ì—¬ì£¼ê¸°
        st.toast("ğŸ‰ ìƒì„± ì™„ë£Œ! ì˜¤ë¥¸ìª½ ìœ„ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ë³µì‚¬í•˜ì„¸ìš”.", icon="âœ…")
        st.success("ğŸ‘‡ ì•„ë˜ ë°•ìŠ¤ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”!")
        st.code(final_prompt, language="text") # ë³µì‚¬ ë²„íŠ¼ì´ ìˆëŠ” ì½”ë“œ ë°•ìŠ¤

    else:
        # ë²„íŠ¼ ëˆ„ë¥´ê¸° ì „ ì•ˆë‚´ ë¬¸êµ¬
        st.info("ğŸ‘ˆ ì™¼ìª½ì—ì„œ ì›í•˜ëŠ” ë‚´ìš©ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.")